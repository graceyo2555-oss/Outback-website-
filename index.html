<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TonFi Ecosystem Index</title>
  <meta name="description" content="Live TonFi ecosystem dashboard: price, market cap, volume, holders, and quick buy/chart links for TON memeâ€‘fi partners." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1020; --card:#0e1530cc; --muted:#9fb2d7; --text:#e9f3ff; --tone:#0098ea; --tone2:#29a9ff; --danger:#ff5577; --ok:#2ecc71; --glass:rgba(255,255,255,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:radial-gradient(1200px 800px at 10% -10%, #123, transparent),radial-gradient(1000px 600px at 100% 0%, #0a1226, transparent),var(--bg);color:var(--text)}
    .wrap{max-width:1200px;margin:0 auto;padding:24px}
    header{display:flex;gap:14px;align-items:center;justify-content:space-between;margin-bottom:20px}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:40px;height:40px;border-radius:50%;box-shadow:0 0 0 2px #0c2744,0 4px 16px #06101f}
    h1{margin:0;font-size:22px;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:13px;margin-top:2px}
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    .input, select, .btn{background:var(--glass);color:var(--text);border:1px solid #1d2b45;border-radius:12px;padding:10px 12px;font-size:14px;outline:none}
    .btn{cursor:pointer;transition:.2s ease;border-color:#214a72;background:linear-gradient(180deg, #11233d, #0e1f37)}
    .btn:hover{transform:translateY(-1px)}
    .tag{font-size:12px;background:#0f1e36;border:1px solid #213455;padding:4px 8px;border-radius:999px;color:#cfe6ff}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
    .card{grid-column:span 12;background:linear-gradient(180deg, #0e1832, #0b1328);border:1px solid #1a2a49;border-radius:18px;padding:14px;box-shadow:0 10px 24px rgba(0,0,0,.35)}
    @media(min-width:680px){.card{grid-column:span 6}}
    @media(min-width:1024px){.card{grid-column:span 4}}
    .row{display:flex;align-items:center;gap:12px}
    .row.stretch{justify-content:space-between}
    .token{display:flex;align-items:center;gap:10px}
    .logo{width:40px;height:40px;border-radius:50%;background:#0a1a33;border:1px solid #214a72;display:grid;place-items:center;overflow:hidden}
    .logo img{width:100%;height:100%;object-fit:cover}
    .name{font-weight:700}
    .sym{opacity:.8;font-size:12px;margin-left:6px}
    .metrics{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
    .metric{background:rgba(255,255,255,.03);border:1px solid #1a2a49;border-radius:12px;padding:10px}
    .metric .label{color:#a9bfdf;font-size:11px}
    .metric .val{font-size:16px;font-weight:700;margin-top:4px}
    .chg.up{color:var(--ok)}
    .chg.down{color:var(--danger)}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .pill{padding:8px 10px;border-radius:12px;border:1px solid #214a72;text-decoration:none;color:#d8eeff;background:linear-gradient(180deg,#0f2340,#0b1d35);font-size:13px}
    .pill:hover{filter:brightness(1.1)}
    .small{font-size:12px;color:#9fb2d7;margin-top:10px}
    .copy{cursor:pointer}
    .empty{opacity:.8;text-align:center;padding:40px;border:1px dashed #213455;border-radius:16px}
    footer{margin-top:26px;color:#89a6c8;font-size:12px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .badge{font-size:11px;padding:6px 8px;border-radius:999px;border:1px solid #214a72;background:#0d2140}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <!-- Use your saved asset name tonfi-logo.png in same folder -->
        <img src="tonfi-logo.png" alt="TonFi" onerror="this.style.display='none'"/>
        <div>
          <h1>TonFi Ecosystem Index</h1>
          <div class="sub">Live view of TonFi partners, meme allies, and integrations on TON.</div>
        </div>
      </div>
      <div class="controls">
        <input id="q" class="input" placeholder="Search by name, symbol, tagâ€¦ (e.g., Crow, 1TON, Meme)" />
        <select id="tag">
          <option value="">All Tags</option>
          <option value="Core">Core</option>
          <option value="Partner">Partner</option>
          <option value="Meme">Meme</option>
          <option value="DeFi">DeFi</option>
          <option value="Tooling">Tooling</option>
        </select>
        <select id="sort">
          <option value="mcap">Sort: Market Cap</option>
          <option value="vol">Sort: 24h Volume</option>
          <option value="price">Sort: Price</option>
          <option value="alpha">Sort: Name Aâ†’Z</option>
          <option value="custom">Sort: Custom (cfg.order)</option>
        </select>
        <button class="btn" id="refresh">Refresh</button>
      </div>
    </header><div id="grid" class="grid"></div>
<div id="empty" class="empty" style="display:none">No projects match your filters (yet). Try clearing search/tags.</div>

<footer>
  <div>Tip: edit the <span class="badge">PROJECTS</span> array in this file to add/update tokens. Data autoâ€‘loads from Dexscreener â†’ GeckoTerminal (fallback) â†’ TonAPI.</div>
  <div>Made with ðŸ’™ on TON â€” <span class="badge">TonFi</span></div>
</footer>

  </div><script>
/**
 * TonFi Ecosystem Index â€” MVP
 * How to use:
 *  1) Drop this single file on Vercel (or any static hosting).
 *  2) Put your tonfi-logo.png in the same folder (or update the <img> src).
 *  3) Fill the PROJECTS array with your tokens and links.
 *  4) Click Refresh. Metrics will fetch automatically.
 *
 * NOTE: CORS policies for some APIs can vary. Dexscreener usually works fine from client-side.
 *       GeckoTerminal + TonAPI are provided as graceful fallbacks.
 */

// === 1) Configure your ecosystem projects here ===
const PROJECTS = [
  // Example: TonFi (edit to real addresses)
  {
    name: "TonFi",
    symbol: "TONFI",
    logo: "tonfi-logo.png",
    tokenAddress: "EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA", // TODO: put TonFi jetton master address
    tags: ["Core", "DeFi"],
    order: 1,
    links: {
      buy: "https://ston.fi/",           // Replace with direct Ston.fi pair
      chart: "https://dexscreener.com/ton/", // Replace with pair page
      site: "https://tonfi.space"
    },
    treasuryWallet: "UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" // optional â€” will display short + copy
  },
  // Example: 1TON
  {
    name: "1TON",
    symbol: "1TON",
    logo: "https://raw.githubusercontent.com/.../1ton.png",
    tokenAddress: "EQBDc5nGD52r2GMIBo4tXaf4qdhUdgod9OxHhRcuRKjBryeJ",
    tags: ["Meme", "Partner"],
    order: 2,
    links: {
      buy: "https://ston.fi/",
      chart: "https://dexscreener.com/ton/",
      site: "https://1ton.space"
    }
  },
  // Example: Crow
  {
    name: "Crow",
    symbol: "CROW",
    logo: "https://raw.githubusercontent.com/.../crow.png",
    tokenAddress: "EQAtwo6qMNwtr0iTA9eKVZ32cuACFJ0VKd78GrBWOe83-X1P",
    tags: ["Meme", "Partner"],
    order: 3,
    links: {
      buy: "https://dedust.io/",
      chart: "https://dexscreener.com/ton/",
      site: "https://t.me/crow"
    }
  }
];

// === 2) Helpers ===
const $ = (sel)=>document.querySelector(sel);
const grid = $("#grid");
const empty = $("#empty");
const q = $("#q");
const tag = $("#tag");
const sortSel = $("#sort");
const refreshBtn = $("#refresh");

const fmt = {
  compact(n){
    if(n==null || isNaN(n)) return "â€”";
    try{ return Intl.NumberFormat(undefined,{notation:'compact',maximumFractionDigits:2}).format(+n) }catch(e){return n}
  },
  money(n){
    if(n==null || isNaN(n)) return "â€”";
    try{ return "$"+Intl.NumberFormat(undefined,{maximumFractionDigits:6}).format(+n) }catch(e){return n}
  },
  pct(n){
    if(n==null || isNaN(n)) return "â€”";
    try{ return (n>0?"+":"")+Intl.NumberFormat(undefined,{maximumFractionDigits:2}).format(+n)+"%" }catch(e){return n}
  },
  shortAddr(a){ if(!a) return ""; return a.slice(0,6)+"â€¦"+a.slice(-6) }
};

function badge(text){return `<span class="tag">${text}</span>`}

function bySort(a,b,mode){
  if(mode==='alpha') return a.name.localeCompare(b.name);
  if(mode==='custom') return (a.order||999) - (b.order||999);
  const ax = (a.metrics||{}), bx=(b.metrics||{});
  if(mode==='price') return (bx.priceUsd||0)-(ax.priceUsd||0);
  if(mode==='vol') return (bx.volume24h||0)-(ax.volume24h||0);
  // default market cap
  return (bx.fdv||bx.marketCap||0) - (ax.fdv||ax.marketCap||0);
}

// === 3) Data fetchers ===
async function fetchDexscreener(addr){
  // Docs: https://docs.dexscreener.com/
  const url = `https://api.dexscreener.io/latest/dex/tokens/${addr}`;
  const r = await fetch(url);
  if(!r.ok) throw new Error('dexscreener fail');
  const j = await r.json();
  const pair = (j.pairs && j.pairs[0]) || null;
  if(!pair) return null;
  return {
    source: 'dexscreener',
    priceUsd: pair.priceUsd ? +pair.priceUsd : null,
    fdv: pair.fdv ? +pair.fdv : null,
    marketCap: pair.marketCap ? +pair.marketCap : null,
    volume24h: pair.volume?.h24 ? +pair.volume.h24 : null,
    change24h: pair.priceChange?.h24 ? +pair.priceChange.h24 : null,
    pairUrl: pair.url || null
  };
}

async function fetchGeckoTerminal(addr){
  // Limited TON support; try common endpoint by token then first pool
  const url = `https://api.geckoterminal.com/api/v2/networks/ton/tokens/${addr}/pools`;
  const r = await fetch(url);
  if(!r.ok) throw new Error('geckoterminal fail');
  const j = await r.json();
  const d = j?.data?.[0]?.attributes || null;
  if(!d) return null;
  return {
    source: 'geckoterminal',
    priceUsd: d?.base_token_price_usd ? +d.base_token_price_usd : null,
    fdv: d?.fdv_usd ? +d.fdv_usd : null,
    marketCap: d?.market_cap_usd ? +d.market_cap_usd : null,
    volume24h: d?.volume_usd?.h24 ? +d.volume_usd.h24 : null,
    change24h: d?.price_change_percentage?.h24 ? +d.price_change_percentage.h24 : null,
    pairUrl: `https://www.geckoterminal.com/ton/tokens/${addr}`
  };
}

async function fetchTonAPI(addr){
  // Holders count / basic token info
  // Docs: https://tonapi.io/ (public endpoints may be rate-limited client-side)
  const url = `https://tonapi.io/v2/jettons/${addr}`;
  const r = await fetch(url);
  if(!r.ok) throw new Error('tonapi fail');
  const j = await r.json();
  const holders = j?.holders_count ?? null;
  const supply = j?.total_supply ?? null;
  return { source:'tonapi', holders, supply };
}

async function hydrate(project){
  const addr = project.tokenAddress;
  const out = { };
  try { Object.assign(out, await fetchDexscreener(addr)); } catch(e){}
  if(!out.priceUsd){ try { Object.assign(out, await fetchGeckoTerminal(addr)); } catch(e){} }
  try { Object.assign(out, await fetchTonAPI(addr)); } catch(e){}
  return out;
}

// === 4) Rendering ===
function projectCard(p){
  const m = p.metrics||{};
  const chgClass = (m.change24h||0) >= 0 ? 'chg up' : 'chg down';
  const pairUrl = p.links?.chart || m.pairUrl || '#';
  return `
    <div class="card" data-name="${(p.name||'').toLowerCase()}" data-tags="${(p.tags||[]).join(',').toLowerCase()}">
      <div class="row stretch">
        <div class="token">
          <div class="logo">${p.logo?`<img src="${p.logo}" alt="${p.symbol}">`:'ðŸª™'}</div>
          <div>
            <div class="name">${p.name} <span class="sym">${p.symbol?`â€¢ ${p.symbol}`:''}</span></div>
            <div class="small">${(p.tags||[]).map(badge).join(' ')}</div>
          </div>
        </div>
        <div class="row" style="gap:8px">
          ${p.treasuryWallet?`<div class="small copy" title="Copy treasury" data-copy="${p.treasuryWallet}">Treasury: ${fmt.shortAddr(p.treasuryWallet)}</div>`:''}
          <div class="small">Last update: <span>${p._updated?new Date(p._updated).toLocaleTimeString():"â€”"}</span></div>
        </div>
      </div>

      <div class="metrics">
        <div class="metric"><div class="label">Price</div><div class="val">${fmt.money(m.priceUsd)}</div></div>
        <div class="metric"><div class="label">FDV / MC</div><div class="val">${m.fdv?fmt.compact(m.fdv):fmt.compact(m.marketCap)}</div></div>
        <div class="metric"><div class="label">24h Vol</div><div class="val">${fmt.compact(m.volume24h)}</div></div>
      </div>

      <div class="small ${chgClass}" style="margin-top:6px">24h: ${fmt.pct(m.change24h)}</div>
      ${m.holders?`<div class="small">Holders: ${fmt.compact(m.holders)}</div>`:''}

      <div class="actions">
        ${p.links?.buy?`<a class="pill" target="_blank" rel="noopener" href="${p.links.buy}">Buy</a>`:''}
        ${pairUrl?`<a class="pill" target="_blank" rel="noopener" href="${pairUrl}">Chart</a>`:''}
        ${p.links?.site?`<a class="pill" target="_blank" rel="noopener" href="${p.links.site}">Website</a>`:''}
        <a class="pill" target="_blank" rel="noopener" href="https://tonviewer.com/${p.tokenAddress}">Tonviewer</a>
      </div>
    </div>`;
}

function applyFilters(){
  const text = (q.value||'').trim().toLowerCase();
  const tagVal = (tag.value||'').toLowerCase();
  const cards = [...grid.children];
  let shown = 0;
  for(const c of cards){
    const name = c.getAttribute('data-name')||'';
    const tags = c.getAttribute('data-tags')||'';
    const matchText = !text || name.includes(text) || tags.includes(text);
    const matchTag = !tagVal || tags.split(',').includes(tagVal);
    const ok = matchText && matchTag;
    c.style.display = ok ? '' : 'none';
    if(ok) shown++;
  }
  empty.style.display = shown? 'none':'block';
}

function render(list){
  grid.innerHTML = list.map(projectCard).join('');
  applyFilters();
}

async function refresh(){
  const list = JSON.parse(JSON.stringify(PROJECTS));
  // hydrate metrics in parallel but limit concurrency to be gentle
  const chunks = 4;
  const out = [];
  for(let i=0;i<list.length;i+=chunks){
    const slice = list.slice(i,i+chunks);
    const hydrated = await Promise.all(slice.map(async p=>{
      try{
        p.metrics = await hydrate(p);
        p._updated = Date.now();
      }catch(e){ p.metrics = {}; }
      return p;
    }));
    out.push(...hydrated);
    render(sort(out)); // progressive render
  }
}

function sort(arr){
  const mode = sortSel.value;
  return arr.sort((a,b)=>bySort(a,b,mode));
}

// === 5) Events ===
q.addEventListener('input', applyFilters);
[tag, sortSel].forEach(el=>el.addEventListener('change', ()=>{ render(sort([...document._current||PROJECTS])); }));
refreshBtn.addEventListener('click', refresh);

grid.addEventListener('click', (e)=>{
  const t = e.target.closest('.copy');
  if(t){
    const v = t.getAttribute('data-copy');
    if(v){ navigator.clipboard.writeText(v); t.textContent = 'Copied!'; setTimeout(()=>t.textContent = 'Treasury: '+fmt.shortAddr(v), 1200); }
  }
});

// Initial render (no metrics yet), then auto-refresh once
render(sort([...PROJECTS]));
refresh();
</script></body>
</html>
